const __vite__fileDeps=["assets/EditTransaction-DKJT9im7.js","assets/index-C3lWn1G8.js","assets/index-C2hKCJDb.css","assets/VRow-BmMO8wa7.js","assets/VRow-CndwlDRC.css","assets/VCard-iDp1f-VJ.js","assets/VCard-BGihEtQu.css","assets/EditTransaction-eUjNdxnE.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as G,r as E,c as H,g as K,u as Q,a as M,w as W,b as m,e as X,o as g,f as l,h as o,i as v,t as c,j as n,k as S,l as U,m as Y,V as Z,n as ee,p as ae,q as te,s as se,_ as le}from"./index-C3lWn1G8.js";import{d as f,u as ne,V as x,a as $,b as B,c as oe,e as re,f as ie,g as ue}from"./VRow-BmMO8wa7.js";const C=window.localStorage,de=G("user",()=>{const h=E(JSON.parse(C.getItem("User")||"{}")),r=E(JSON.parse(C.getItem("Funds")||'{"value": 0}'));return{user:h,funds:r,setFunds:i=>{r.value=i?parseFloat(i):null,r.updated_at=new Date().toISOString(),C.setItem("Funds",JSON.stringify(r))}}});var I={exports:{}};(function(h,r){(function(V,i){h.exports=i()})(H,function(){return function(V,i){i.prototype.isSameOrAfter=function(p,d){return this.isSame(p,d)||this.isAfter(p,d)}}})})(I);var ce=I.exports;const fe=K(ce),ve={class:"text-h4 d-flex align-center"},me={key:0,class:"text-body-1 mt-1"},pe={key:1,class:"text-caption"},ye={class:"font-weight-bold"},_e={class:"text-h5 mb-2"},be={key:0,class:"text-success"},ge={key:1,class:"text-error"},xe={class:"text-center py-2"},he=v("div",null,"Can't budget without any transactions!",-1),Me={__name:"BudgetView",setup(h){f.extend(fe);const r=de(),V=ne();te();const{mobile:i,md:p}=Q(),{commaNumber:d}=ue(),j=se(()=>le(()=>import("./EditTransaction-DKJT9im7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),D=M({});W(()=>r.funds,s=>D.value=s,{immediate:!0});const w=m(()=>{var s;return(s=r.funds)!=null&&s.updated_at?f(r.funds.updated_at).format("MMMM DD, YYYY"):null}),J=()=>r.setFunds(D.value.value),y=M(f().startOf("day")),k=M(60),O=m(()=>y.value.add(parseInt(k.value||0)+1,"days").startOf("day")),A=m(()=>{const s=[];return V.transactionsList.forEach(a=>{let e=a.end_date?f(a.end_date):null;if(e&&e.isBefore(y.value))return;let t=f(a.start_date);if(!a.interval_value&&t.isBefore(y.value)||t.isSameOrAfter(O.value))return;if(a.interval_value){let N=Math.floor(t.diff(y.value,a.interval));if(N>0){let q=Math.floor(N/a.interval_value);t=t.add(q+a.interval_value,a.interval)}}const{id:T,name:R,value:z,sign:L}=a;for(;t.isBefore(O.value)&&t.isSameOrAfter(y.value)&&(!e||e&&t.isBefore(e))&&(s.push({id:`${T}-${t.format("YYYY-MM-DD")}`,tansaction_id:T,name:R,value:z,sign:L,day:t}),!!a.interval_value);)t=t.add(a.interval_value,a.interval)}),s.sort((a,e)=>a.day.isSame(e.day,"day")?0:a.day.isBefore(e.day)?-1:1),s}),F=m(()=>A.value.length),_=m(()=>{let s=parseFloat(r.funds.value)||0;const a=A.value;for(let e=0;e<F.value;e++){let t=a[e];s+=t.value*t.sign,t.balance=s,t.day=t.day.toDate(),t.index=e}return a}),P=[{title:"Date",key:"day"},{title:"Name",key:"name",sortable:!1},{title:"Amount",key:"value",sortable:!1},{title:"Balance",key:"balance",sortable:!1}],u=m(()=>{let s=_.value[0];_.value.forEach(e=>{e.balance<s.balance&&(s=e)});let a=s?_.value[s.index+1]:null;if(a)for(let e=a.index;e<F.value;e++){let t=_.value[e];t.balance<a.balance&&(a=t)}return[s,a]}),b=M(!1);return(s,a)=>(g(),X(ie,{fluid:""},{default:l(()=>[o(B,{class:"mt-2"},{default:l(()=>[o(x,null,{default:l(()=>{var e;return[v("div",ve,"Budget: "+c(n(d)((e=u.value[0])==null?void 0:e.balance)),1),u.value[0]?(g(),S("div",me,"until "+c(n(f)(u.value[0].day).format("ddd, MMMM DD, YYYY")),1)):U("",!0),u.value[0]&&u.value[1]&&u.value[0].day!=u.value[1].day?(g(),S("div",pe,[Y("then "),v("span",ye,c(n(d)(u.value[1].balance))+"Â ",1),Y("until "+c(n(f)(u.value[1].day).format("ddd, MMMM DD, YYYY")),1)])):U("",!0)]}),_:1}),o(x,{class:"d-flex align-center",cols:n(i)?12:n(p)?4:3},{default:l(()=>[o($,{label:"Current Funds",modelValue:D.value.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value.value=e),type:"number",min:1,"prepend-icon":"mdi-cash-multiple",onChange:J,density:"default",hint:`Updated ${w.value}`,"persistent-hint":!!w.value},null,8,["modelValue","hint","persistent-hint"])]),_:1},8,["cols"])]),_:1}),o(B,null,{default:l(()=>[o(x,null,{default:l(()=>[o(oe,{items:_.value,headers:P,"sort-by":[{key:"day",order:"asc"}],sticky:"",density:"compact"},{top:l(()=>[o(B,{class:"mb-2"},{default:l(()=>[o(x,{class:"d-flex align-start"},{default:l(()=>[v("div",_e,[Y("Upcoming Transactions"),o(Z,{class:"ml-2",icon:"mdi-plus",onClick:a[1]||(a[1]=e=>b.value=!0),size:"small",variant:"text"})])]),_:1}),o(x,{class:"d-flex align-start",cols:n(i)?12:n(p)?4:3},{default:l(()=>[o($,{label:"Budget Days",modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),type:"number","prepend-icon":"mdi-calendar-month"},null,8,["modelValue"])]),_:1},8,["cols"])]),_:1})]),"item.day":l(({item:e})=>[Y(c(n(f)(e.day).format("ddd, MMMM DD, YYYY")),1)]),"item.value":l(({item:e})=>[e.sign==1?(g(),S("div",be,"+ "+c(n(d)(e.value)),1)):(g(),S("div",ge,"- "+c(n(d)(e.value)),1))]),"item.balance":l(({item:e})=>[v("span",{class:ee(e.balance<0?"text-error":null)},c(n(d)(e.balance)),3)]),"no-data":l(()=>[v("div",xe,[he,v("a",{href:"",onClick:a[3]||(a[3]=ae(e=>b.value=!0,["prevent"]))},"Add one")])]),_:1},8,["items"])]),_:1})]),_:1}),o(re,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e),persistent:"",fullscreen:n(i),transition:n(i)?"dialog-bottom-transition":"dialog-transition"},{default:l(()=>[o(n(j),{class:"mx-auto",item:{},onClose:a[4]||(a[4]=e=>b.value=!1)})]),_:1},8,["modelValue","fullscreen","transition"])]),_:1}))}};export{Me as default};
