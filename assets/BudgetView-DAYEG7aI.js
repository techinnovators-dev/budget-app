const __vite__fileDeps=["assets/EditTransaction-Cfr-CwnL.js","assets/index-Dn1tHYn8.js","assets/index-C2hKCJDb.css","assets/VContainer-CwMW_I8y.js","assets/VContainer-CndwlDRC.css","assets/VCard-DsVzwSca.js","assets/VCard-BGihEtQu.css","assets/VRow-B9Sagix2.js","assets/EditTransaction-eUjNdxnE.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as q,r as N,c as G,g as H,u as K,a as Y,w as Q,b as x,o as g,e as W,f as n,h as o,i as y,t as f,j as c,k as S,l as T,m as E,V as X,n as Z,p as ee,q as ae,_ as te}from"./index-Dn1tHYn8.js";import{d as v,u as se,V as le,a as U,b as ne,c as oe,e as re}from"./VContainer-CwMW_I8y.js";import{V as h,a as B}from"./VRow-B9Sagix2.js";const C=window.localStorage,ue=q("user",()=>{const V=N(JSON.parse(C.getItem("User")||"{}")),d=N(JSON.parse(C.getItem("Funds")||'{"value": 0}'));return{user:V,funds:d,setFunds:r=>{d.value=r?parseFloat(r):null,d.updated_at=new Date().toISOString(),C.setItem("Funds",JSON.stringify(d))}}});var $={exports:{}};(function(V,d){(function(D,r){V.exports=r()})(G,function(){return function(D,r){r.prototype.isSameOrAfter=function(M,m){return this.isSame(M,m)||this.isAfter(M,m)}}})})($);var de=$.exports;const ie=H(de),ce={class:"text-h4"},fe={key:0,class:"text-body-1 mt-1"},ve={key:1,class:"text-caption"},me={class:"text-h5 mb-2"},pe={key:0,class:"text-success"},ye={key:1,class:"text-error"},_e={class:"text-center py-2"},be=y("div",null,"Can't budget without any transactions!",-1),Ve={__name:"BudgetView",setup(V){v.extend(ie);const d=ue(),D=se();K();const{commaNumber:r}=re(),M=ae(()=>te(()=>import("./EditTransaction-Cfr-CwnL.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),m=Y({});Q(()=>d.funds,s=>m.value=s,{immediate:!0});const O=x(()=>{var s;return(s=d.funds)!=null&&s.updated_at?v(d.funds.updated_at).format("MMMM DD, YYYY"):null}),I=()=>d.setFunds(m.value.value),_=Y(v().startOf("day")),k=Y(60),w=x(()=>_.value.add(parseInt(k.value||0)+1,"days").startOf("day")),p=x(()=>{const s=[];D.transactionsList.forEach(a=>{let l=a.end_date?v(a.end_date):null;if(l&&l.isBefore(_.value))return;let u=v(a.start_date);if(!a.interval_value&&u.isBefore(_.value)||u.isSameOrAfter(w.value))return;if(a.interval_value){let F=Math.floor(u.diff(_.value,a.interval));if(F>0){let L=Math.floor(F/a.interval_value);u=u.add(L+a.interval_value,a.interval)}}const{id:A,name:P,value:R,sign:z}=a;for(;u.isBefore(w.value)&&u.isSameOrAfter(_.value)&&(!l||l&&u.isBefore(l))&&(s.push({id:`${A}-${u.format("YYYY-MM-DD")}`,tansaction_id:A,name:P,value:R,sign:z,day:u}),!!a.interval_value);)u=u.add(a.interval_value,a.interval)}),s.sort((a,l)=>a.day.isSame(l.day,"day")?0:a.day.isBefore(l.day)?-1:1);let t=parseFloat(d.funds.value)||0;const e=s.length;for(let a=0;a<e;a++){let l=s[a];t+=l.value*l.sign,l.balance=t,l.day=l.day.toDate(),l.index=a}return s}),j=x(()=>p.value.length),J=[{title:"Date",key:"day"},{title:"Name",key:"name",sortable:!1},{title:"Amount",key:"value",sortable:!1},{title:"Balance",key:"balance",sortable:!1}],i=x(()=>{let s=p.value[0];p.value.forEach(e=>{e.balance<s.balance&&(s=e)});let t=s?p.value[s.index+1]:null;if(t)for(let e=t.index;e<j.value;e++){let a=p.value[e];a.balance<t.balance&&(t=a)}return[s,t]}),b=Y(!1);return(s,t)=>(g(),W(le,{fluid:""},{default:n(()=>[o(B,{class:"mt-2"},{default:n(()=>[o(h,null,{default:n(()=>{var e;return[y("div",ce,"Your Budget: "+f(c(r)((e=i.value[0])==null?void 0:e.balance)),1),i.value[0]?(g(),S("div",fe,"until "+f(c(v)(i.value[0].day).format("ddd, MMMM DD, YYYY")),1)):T("",!0),i.value[0]&&i.value[1]&&i.value[0].day!=i.value[1].day?(g(),S("div",ve,"then "+f(c(r)(i.value[1].balance))+" until "+f(c(v)(i.value[1].day).format("ddd, MMMM DD, YYYY")),1)):T("",!0)]}),_:1}),o(h,{class:"d-flex align-center",cols:"3"},{default:n(()=>[o(U,{label:"Current Funds",modelValue:m.value.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value.value=e),type:"number",min:1,"prepend-icon":"mdi-cash-multiple",onChange:I,density:"default",hint:`Updated ${O.value}`,"persistent-hint":!!O.value},null,8,["modelValue","hint","persistent-hint"])]),_:1})]),_:1}),o(B,null,{default:n(()=>[o(h,null,{default:n(()=>[o(ne,{items:p.value,headers:J,"sort-by":[{key:"day",order:"asc"}],sticky:"",density:"compact"},{top:n(()=>[o(B,{class:"mb-2"},{default:n(()=>[o(h,{class:"d-flex align-start"},{default:n(()=>[y("div",me,[E("Upcoming Transactions"),o(X,{class:"ml-2",icon:"mdi-plus",onClick:t[1]||(t[1]=e=>b.value=!0),size:"small",variant:"text"})])]),_:1}),o(h,{class:"d-flex align-start",cols:"3"},{default:n(()=>[o(U,{label:"Budget Days",modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),type:"number","prepend-icon":"mdi-calendar-month"},null,8,["modelValue"])]),_:1})]),_:1})]),"item.day":n(({item:e})=>[E(f(c(v)(e.day).format("ddd, MMMM DD, YYYY")),1)]),"item.value":n(({item:e})=>[e.sign==1?(g(),S("div",pe,"+ "+f(c(r)(e.value)),1)):(g(),S("div",ye,"- "+f(c(r)(e.value)),1))]),"item.balance":n(({item:e})=>[y("span",{class:Z(e.balance<0?"text-error":null)},f(c(r)(e.balance)),3)]),"no-data":n(()=>[y("div",_e,[be,y("a",{href:"",onClick:t[3]||(t[3]=ee(e=>b.value=!0,["prevent"]))},"Add one")])]),_:1},8,["items"])]),_:1})]),_:1}),o(oe,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e),persistent:""},{default:n(()=>[o(c(M),{class:"mx-auto",item:{},onClose:t[4]||(t[4]=e=>b.value=!1)})]),_:1},8,["modelValue"])]),_:1}))}};export{Ve as default};
