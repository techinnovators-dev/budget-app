const __vite__fileDeps=["assets/EditTransaction-CzFxMuup.js","assets/index-d62jCz__.js","assets/index-BUgSi1mf.css","assets/VContainer-BMFvagy-.js","assets/VContainer-CndwlDRC.css","assets/VCard-CmAqC85b.js","assets/VCard-BGihEtQu.css","assets/VRow-eeUtkUBl.js","assets/EditTransaction-eUjNdxnE.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as L,r as T,c as q,g as G,u as W,a as k,w as H,b,o as h,e as K,f as n,h as o,i as v,t as c,j as i,k as B,l as Q,m as N,V as X,n as Z,p as ee,q as ae,_ as te}from"./index-d62jCz__.js";import{d as f,u as se,V as le,a as E,b as ne,c as oe,e as re}from"./VContainer-BMFvagy-.js";import{V as x,a as C}from"./VRow-eeUtkUBl.js";const O=window.localStorage,de=L("user",()=>{const g=T(JSON.parse(O.getItem("User")||"{}")),u=T(JSON.parse(O.getItem("Funds")||'{"value": 0}'));return{user:g,funds:u,setFunds:d=>{u.value=d?parseFloat(d):null,u.updated_at=new Date().toISOString(),O.setItem("Funds",JSON.stringify(u))}}});var U={exports:{}};(function(g,u){(function(D,d){g.exports=d()})(q,function(){return function(D,d){d.prototype.isSameOrAfter=function(M,m){return this.isSame(M,m)||this.isAfter(M,m)}}})})(U);var ue=U.exports;const ie=G(ue),ce={class:"text-h4"},fe={class:"text-body-1 mt-1"},me={key:0,class:"text-caption"},ve={class:"text-h5 mb-2"},pe={key:0,class:"text-success"},ye={key:1,class:"text-error"},_e={class:"text-center py-2"},Ye=v("div",null,"Can't budget without any transactions!",-1),De={__name:"BudgetView",setup(g){f.extend(ie);const u=de(),D=se();W();const{commaNumber:d}=re(),M=ae(()=>te(()=>import("./EditTransaction-CzFxMuup.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),m=k({});H(()=>u.funds,l=>m.value=l,{immediate:!0});const w=b(()=>{var l;return(l=u.funds)!=null&&l.updated_at?f(u.funds.updated_at).format("MMMM DD, YYYY"):null}),$=()=>u.setFunds(m.value.value),_=f().startOf("day"),V=k(60),S=b(()=>_.add(V.value+1,"days").startOf("day")),p=b(()=>{const l=[];D.transactionsList.forEach(a=>{let s=a.end_date?f(a.end_date):null;if(s&&s.isBefore(_))return;let r=f(a.start_date);if(!a.interval_value&&r.isBefore(_)||r.isSameOrAfter(S.value))return;if(a.interval_value){let F=Math.floor(r.diff(_,a.interval));if(F>0){let z=Math.floor(F/a.interval_value);r=r.add(z+a.interval_value,a.interval)}}const{id:A,name:J,value:P,sign:R}=a;for(;r.isBefore(S.value)&&r.isSameOrAfter(_)&&(!s||r.isBefore(s))&&(a.name=="2 Week Test"&&console.log(r.format("YYYY-MM-DD"),S.value.format("YYYY-MM-DD"),s==null?void 0:s.format("YYYY-MM-DD")),l.push({id:`${A}-${r.format("YYYY-MM-DD")}`,tansaction_id:A,name:J,value:P,sign:R,day:r}),!!a.interval_value);)r=r.add(a.interval_value,a.interval)}),l.sort((a,s)=>a.day.isSame(s.day,"day")?0:a.day.isBefore(s.day)?-1:1);let t=parseFloat(u.funds.value)||0;const e=l.length;for(let a=0;a<e;a++){let s=l[a];t+=s.value*s.sign,s.balance=t,s.day=s.day.toDate(),s.index=a}return l}),I=b(()=>p.value.length),j=[{title:"Date",key:"day"},{title:"Name",key:"name",sortable:!1},{title:"Amount",key:"value",sortable:!1},{title:"Balance",key:"balance",sortable:!1}],y=b(()=>{let l=p.value[0];p.value.forEach(e=>{e.balance<l.balance&&(l=e)});let t=p.value[l.index+1];if(t)for(let e=t.index;e<I.value;e++){let a=p.value[e];a.balance<t.balance&&(t=a)}return[l,t]}),Y=k(!1);return(l,t)=>(h(),K(le,{fluid:""},{default:n(()=>[o(C,{class:"mt-2"},{default:n(()=>[o(x,null,{default:n(()=>[v("div",ce,"Your Budget: "+c(i(d)(y.value[0].balance)),1),v("div",fe,"until "+c(i(f)(y.value[0].day).format("ddd, MMMM DD, YYYY")),1),y.value[0].day!=y.value[1].day?(h(),B("div",me,"then "+c(i(d)(y.value[1].balance))+" until "+c(i(f)(y.value[1].day).format("ddd, MMMM DD, YYYY")),1)):Q("",!0)]),_:1}),o(x,{class:"d-flex align-center",cols:"3"},{default:n(()=>[o(E,{label:"Current Funds",modelValue:m.value.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value.value=e),type:"number","prepend-icon":"mdi-cash-multiple",onChange:$,density:"default",hint:`Updated ${w.value}`,"persistent-hint":!!w.value},null,8,["modelValue","hint","persistent-hint"])]),_:1})]),_:1}),o(C,null,{default:n(()=>[o(x,null,{default:n(()=>[o(ne,{items:p.value,headers:j,"sort-by":[{key:"day",order:"asc"}],sticky:"",density:"compact"},{top:n(()=>[o(C,{class:"mb-2"},{default:n(()=>[o(x,{class:"d-flex align-start"},{default:n(()=>[v("div",ve,[N("Upcoming Transactions"),o(X,{class:"ml-2",icon:"mdi-plus",onClick:t[1]||(t[1]=e=>Y.value=!0),size:"small",variant:"text"})])]),_:1}),o(x,{class:"d-flex align-start",cols:"3"},{default:n(()=>[o(E,{label:"Budget Days",modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=e=>V.value=e),type:"number","prepend-icon":"mdi-calendar-month"},null,8,["modelValue"])]),_:1})]),_:1})]),"item.day":n(({item:e})=>[N(c(i(f)(e.day).format("ddd, MMMM DD, YYYY")),1)]),"item.value":n(({item:e})=>[e.sign==1?(h(),B("div",pe,"+ "+c(i(d)(e.value)),1)):(h(),B("div",ye,"- "+c(i(d)(e.value)),1))]),"item.balance":n(({item:e})=>[v("span",{class:Z(e.balance<0?"text-error":null)},c(i(d)(e.balance)),3)]),"no-data":n(()=>[v("div",_e,[Ye,v("a",{href:"",onClick:t[3]||(t[3]=ee(e=>Y.value=!0,["prevent"]))},"Add one")])]),_:1},8,["items"])]),_:1})]),_:1}),o(oe,{modelValue:Y.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Y.value=e),persistent:""},{default:n(()=>[o(i(M),{class:"mx-auto",item:{},onClose:t[4]||(t[4]=e=>Y.value=!1)})]),_:1},8,["modelValue"])]),_:1}))}};export{De as default};
